------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
      name:  <unnamed>
       log:  E:\analyses\nsaids-covid-research\analysis\nsaid_log\Naproxen_04_an_descriptive_table.log
  log type:  text
 opened on:   7 Oct 2020, 14:07:27

. 
. * Open Stata dataset
. use $tempdir\analysis_dataset, clear

. 
. /*==============================================================================*/
. drop exposure

. rename naproxen_dose exposure

. 
. /* PROGRAMS TO AUTOMATE TABULATIONS===========================================*/ 
. 
. ********************************************************************************
. * All below code from K Baskharan 
. * Generic code to output one row of table
. 
. cap prog drop generaterow

. program define generaterow
  1. syntax, variable(varname) condition(string) 
  2.         
.         safecount
  3.         local overalldenom=r(N)
  4.         
.         qui sum `variable' if `variable' `condition'
  5.         file write tablecontent (r(max)) _tab
  6.         
.         safecount if `variable' `condition'
  7.         local rowdenom = r(N)
  8.         local colpct = 100*(r(N)/`overalldenom')
  9.         file write tablecontent %9.0gc (`rowdenom')  (" (") %3.1f (`colpct') (")") _tab
 10. 
.         safecount if exposure == 0 
 11.         local rowdenom = r(N)
 12.         safecount if exposure == 0 & `variable' `condition'
 13.         local pct = 100*(r(N)/`rowdenom') 
 14.         file write tablecontent %9.0gc (r(N)) (" (") %3.1f (`pct') (")") _tab
 15. 
.         safecount if exposure == 1 
 16.         local rowdenom = r(N)
 17.         safecount if exposure == 1 & `variable' `condition'
 18.         local pct = 100*(r(N)/`rowdenom')
 19.         file write tablecontent %9.0gc (r(N)) (" (") %3.1f  (`pct') (")") _n
 20.         
. end

. 
. 
. /* Explanatory Notes 
> 
> defines a program (SAS macro/R function equivalent), generate row
> the syntax row specifies two inputs for the program: 
> 
>         a VARNAME which is your variable 
>         a CONDITION which is a string of some condition you impose 
>         
> the program counts if variable and condition and returns the counts
> column percentages are then automatically generated
> this is then written to the text file 'tablecontent' 
> the number followed by space, brackets, formatted pct, end bracket and then tab
> 
> the format %3.1f specifies length of 3, followed by 1 dp. 
> 
> */ 
. 
. ********************************************************************************
. * Generic code to output one section (varible) within table (calls above)
. 
. cap prog drop tabulatevariable

. prog define tabulatevariable
  1. syntax, variable(varname) min(real) max(real) [missing]
  2. 
.         local lab: variable label `variable'
  3.         file write tablecontent ("`lab'") _n 
  4. 
.         forvalues varlevel = `min'/`max'{ 
  5.                 generaterow, variable(`variable') condition("==`varlevel'")
  6.         }
  7.         
.         if "`missing'"!="" generaterow, variable(`variable') condition(">=.")
  8. 
. end

. 
. ********************************************************************************
. 
. /* Explanatory Notes 
> 
> defines program tabulate variable 
> syntax is : 
> 
>         - a VARNAME which you stick in variable 
>         - a numeric minimum 
>         - a numeric maximum 
>         - optional missing option, default value is . 
> 
> forvalues lowest to highest of the variable, manually set for each var
> run the generate row program for the level of the variable 
> if there is a missing specified, then run the generate row for missing vals
> 
> */ 
. 
. ********************************************************************************
. * Generic code to summarise a continuous variable 
. 
. cap prog drop summarizevariable 

. prog define summarizevariable
  1. syntax, variable(varname) 
  2. 
.         local lab: variable label `variable'
  3.         file write tablecontent ("`lab'") _n 
  4.         
.         qui summarize `variable', d
  5.         file write tablecontent ("Median (IQR)") _tab 
  6.         file write tablecontent (r(p50)) (" (") (r(p25)) ("-") (r(p75)) (")") _tab
  7.                                                         
.         qui summarize `variable' if exposure == 0, d
  8.         file write tablecontent (r(p50)) (" (") (r(p25)) ("-") (r(p75)) (")") _tab
  9.         
.     qui summarize `variable' if exposure == 1, d
 10.         file write tablecontent (r(p50)) (" (") (r(p25)) ("-") (r(p75)) (")") _tab
 11.         
.         qui summarize `variable' if exposure == 2, d
 12.         file write tablecontent (r(p50)) (" (") (r(p25)) ("-") (r(p75)) (")") _tab
 13. 
.         qui summarize `variable' if exposure == 3, d
 14.         file write tablecontent (r(p50)) (" (") (r(p25)) ("-") (r(p75)) (")") _n
 15.         
.         qui summarize `variable', d
 16.         file write tablecontent ("Min, Max") _tab 
 17.         file write tablecontent (r(min)) (", ") (r(max)) ("") _tab
 18.                                                         
.         qui summarize `variable' if exposure == 0, d
 19.         file write tablecontent (r(min)) (", ") (r(max)) ("") _tab
 20.         
.         qui summarize `variable' if exposure == 1, d
 21.         file write tablecontent (r(min)) (", ") (r(max)) ("") _tab
 22.         
.         qui summarize `variable' if exposure == 2, d
 23.         file write tablecontent (r(min)) (", ") (r(max)) ("") _tab
 24. 
.         qui summarize `variable' if exposure == 3, d
 25.         file write tablecontent (r(min)) (", ") (r(max)) ("") _n
 26.         
. end

. 
. /* INVOKE PROGRAMS FOR TABLE 1================================================*/ 
. 
. *Set up output file
. cap file close tablecontent

. file open tablecontent using ./$outdir/table8.txt, write text replace
(note: file ./nsaid_output/table8.txt not found)

. 
. file write tablecontent ("Table 8: Demographic and Clinical Characteristics - $population") _n

. 
. * Exposure labelled columns
. 
. local lab0: label dose 0

. local lab1: label dose 1

. local lab2: label dose 2

. local lab3: label dose 3

. 
. file write tablecontent _tab ("Total")                                                    _tab ///
>                                                          ("`lab0'")                                                   _tab ///
>                                                          ("`lab1'")                                                   _tab ///
>                                                          ("`lab2'")                                                   _tab ///
>                                                          ("`lab3'")                                               _n

. 
. * DEMOGRAPHICS (more than one level, potentially missing) 
. 
. gen byte cons=1

. tabulatevariable, variable(cons) min(1) max(1) 
  2,463,707
  2,463,707
  1,927,284
  1,927,284
  109,656
  109,656

. file write tablecontent _n 

. 
. tabulatevariable, variable(agegroup) min(1) max(6) 
  2,463,707
  714,371
  1,927,284
  598,513
  109,656
  23,522
  2,463,707
  500,277
  1,927,284
  397,201
  109,656
  19,265
  2,463,707
  557,003
  1,927,284
  423,937
  109,656
  25,271
  2,463,707
  389,844
  1,927,284
  283,639
  109,656
  22,527
  2,463,707
  231,502
  1,927,284
  169,281
  109,656
  14,762
  2,463,707
  70,710
  1,927,284
  54,713
  109,656
  4,309

. file write tablecontent _n 

. 
. tabulatevariable, variable(male) min(0) max(1) 
  2,463,707
  1,410,922
  1,927,284
  1,093,581
  109,656
  68,877
  2,463,707
  1,052,785
  1,927,284
  833,703
  109,656
  40,779

. file write tablecontent _n 

. 
. tabulatevariable, variable(bmicat) min(1) max(6) missing
  2,463,707
  32,476
  1,927,284
  26,435
  109,656
  1,398
  2,463,707
  599,519
  1,927,284
  484,862
  109,656
  24,845
  2,463,707
  736,660
  1,927,284
  577,087
  109,656
  33,230
  2,463,707
  439,568
  1,927,284
  333,254
  109,656
  21,537
  2,463,707
  188,465
  1,927,284
  138,059
  109,656
  9,848
  2,463,707
  101,941
  1,927,284
  71,503
  109,656
  5,773
  2,463,707
  365,078
  1,927,284
  296,084
  109,656
  13,025

. file write tablecontent _n 

. 
. tabulatevariable, variable(smoke) min(1) max(3) missing 
  2,463,707
  1,061,549
  1,927,284
  841,256
  109,656
  46,750
  2,463,707
  872,422
  1,927,284
  665,068
  109,656
  41,757
  2,463,707
  492,598
  1,927,284
  389,340
  109,656
  19,946
  2,463,707
  37,138
  1,927,284
  31,620
  109,656
  1,203

. file write tablecontent _n 

. 
. tabulatevariable, variable(smoke_nomiss) min(1) max(3) missing 
  2,463,707
  1,098,687
  1,927,284
  872,876
  109,656
  47,953
  2,463,707
  872,422
  1,927,284
  665,068
  109,656
  41,757
  2,463,707
  492,598
  1,927,284
  389,340
  109,656
  19,946
  2,463,707
  0
  1,927,284
  0
  109,656
  0

. file write tablecontent _n 

. 
. tabulatevariable, variable(ethnicity) min(1) max(5) missing 
  2,463,707
  1,594,505
  1,927,284
  1,236,854
  109,656
  72,279
  2,463,707
  25,252
  1,927,284
  20,556
  109,656
  1,005
  2,463,707
  184,543
  1,927,284
  151,533
  109,656
  8,711
  2,463,707
  60,145
  1,927,284
  49,618
  109,656
  2,244
  2,463,707
  37,139
  1,927,284
  30,214
  109,656
  1,517
  2,463,707
  562,123
  1,927,284
  438,509
  109,656
  23,900

. file write tablecontent _n 

. 
. tabulatevariable, variable(imd) min(1) max(5) missing
  2,463,707
  495,910
  1,927,284
  388,369
  109,656
  21,688
  2,463,707
  496,425
  1,927,284
  387,428
  109,656
  21,656
  2,463,707
  489,983
  1,927,284
  382,357
  109,656
  22,087
  2,463,707
  491,196
  1,927,284
  384,598
  109,656
  22,235
  2,463,707
  490,193
  1,927,284
  384,532
  109,656
  21,990
  2,463,707
  0
  1,927,284
  0
  109,656
  0

. file write tablecontent _n 

. 
. tabulatevariable, variable(diabcat) min(1) max(4) missing
  2,463,707
  2,226,311
  1,927,284
  1,749,827
  109,656
  96,511
  2,463,707
  164,785
  1,927,284
  122,653
  109,656
  9,464
  2,463,707
  66,772
  1,927,284
  50,268
  109,656
  3,424
  2,463,707
  5,839
  1,927,284
  4,536
  109,656
  257
  2,463,707
  0
  1,927,284
  0
  109,656
  0

. file write tablecontent _n 

. 
. tabulatevariable, variable(diab_control) min(1) max(3) missing
  2,463,707
  2,226,311
  1,927,284
  1,749,827
  109,656
  96,511
  2,463,707
  164,785
  1,927,284
  122,653
  109,656
  9,464
  2,463,707
  72,611
  1,927,284
  54,804
  109,656
  3,681
  2,463,707
  0
  1,927,284
  0
  109,656
  0

. file write tablecontent _n 

. 
. tabulatevariable, variable(arthritis_type) min(0) max(3) missing
  2,463,707
  1,902,680
  1,927,284
  1,541,752
  109,656
  73,524
  2,463,707
  30,397
  1,927,284
  17,578
  109,656
  2,120
  2,463,707
  510,811
  1,927,284
  356,842
  109,656
  32,543
  2,463,707
  19,819
  1,927,284
  11,112
  109,656
  1,469
  2,463,707
  0
  1,927,284
  0
  109,656
  0

. file write tablecontent _n 

. 
. tabulatevariable, variable(hypertension) min(0) max(1) missing
  2,463,707
  1,981,826
  1,927,284
  1,573,481
  109,656
  81,982
  2,463,707
  481,881
  1,927,284
  353,803
  109,656
  27,674
  2,463,707
  0
  1,927,284
  0
  109,656
  0

. file write tablecontent _n 

. 
. tabulatevariable, variable(heart_failure) min(0) max(1) missing
  2,463,707
  2,451,762
  1,927,284
  1,917,772
  109,656
  109,118
  2,463,707
  11,945
  1,927,284
  9,512
  109,656
  538
  2,463,707
  0
  1,927,284
  0
  109,656
  0

. file write tablecontent _n 

. 
. tabulatevariable, variable(other_heart_disease) min(0) max(1) missing
  2,463,707
  2,427,100
  1,927,284
  1,899,403
  109,656
  107,780
  2,463,707
  36,607
  1,927,284
  27,881
  109,656
  1,876
  2,463,707
  0
  1,927,284
  0
  109,656
  0

. file write tablecontent _n 

. 
. tabulatevariable, variable(diabetes) min(0) max(1) missing
  2,463,707
  2,226,311
  1,927,284
  1,749,827
  109,656
  96,511
  2,463,707
  237,396
  1,927,284
  177,457
  109,656
  13,145
  2,463,707
  0
  1,927,284
  0
  109,656
  0

. file write tablecontent _n 

. 
. tabulatevariable, variable(copd) min(0) max(1) missing
  2,463,707
  2,405,636
  1,927,284
  1,884,648
  109,656
  106,376
  2,463,707
  58,071
  1,927,284
  42,636
  109,656
  3,280
  2,463,707
  0
  1,927,284
  0
  109,656
  0

. file write tablecontent _n 

. 
. tabulatevariable, variable(other_respiratory) min(0) max(1) missing
  2,463,707
  2,440,243
  1,927,284
  1,910,014
  109,656
  108,384
  2,463,707
  23,464
  1,927,284
  17,270
  109,656
  1,272
  2,463,707
  0
  1,927,284
  0
  109,656
  0

. file write tablecontent _n 

. 
. tabulatevariable, variable(cancer) min(0) max(1) missing
  2,463,707
  2,336,264
  1,927,284
  1,831,969
  109,656
  102,897
  2,463,707
  127,443
  1,927,284
  95,315
  109,656
  6,759
  2,463,707
  0
  1,927,284
  0
  109,656
  0

. file write tablecontent _n 

. 
. tabulatevariable, variable(immunodef_any) min(0) max(1) missing
  2,463,707
  2,451,504
  1,927,284
  1,917,999
  109,656
  109,090
  2,463,707
  12,203
  1,927,284
  9,285
  109,656
  566
  2,463,707
  0
  1,927,284
  0
  109,656
  0

. file write tablecontent _n 

. 
. tabulatevariable, variable(ckd) min(0) max(1) missing
  2,463,707
  2,394,495
  1,927,284
  1,875,642
  109,656
  105,599
  2,463,707
  69,212
  1,927,284
  51,642
  109,656
  4,057
  2,463,707
  0
  1,927,284
  0
  109,656
  0

. file write tablecontent _n 

. 
. tabulatevariable, variable(osteoarthritis) min(0) max(1) missing
  2,463,707
  1,933,077
  1,927,284
  1,559,330
  109,656
  75,644
  2,463,707
  530,630
  1,927,284
  367,954
  109,656
  34,012
  2,463,707
  0
  1,927,284
  0
  109,656
  0

. file write tablecontent _n 

. 
. tabulatevariable, variable(rheumatoid) min(0) max(1) missing
  2,463,707
  2,413,491
  1,927,284
  1,898,594
  109,656
  106,067
  2,463,707
  50,216
  1,927,284
  28,690
  109,656
  3,589
  2,463,707
  0
  1,927,284
  0
  109,656
  0

. file write tablecontent _n 

. 
. tabulatevariable, variable(flu_vaccine) min(0) max(1) missing
  2,463,707
  1,866,242
  1,927,284
  1,491,901
  109,656
  74,349
  2,463,707
  597,465
  1,927,284
  435,383
  109,656
  35,307
  2,463,707
  0
  1,927,284
  0
  109,656
  0

. file write tablecontent _n 

. 
. tabulatevariable, variable(pneumococcal_vaccine) min(0) max(1) missing
  2,463,707
  2,302,341
  1,927,284
  1,810,820
  109,656
  99,989
  2,463,707
  161,366
  1,927,284
  116,464
  109,656
  9,667
  2,463,707
  0
  1,927,284
  0
  109,656
  0

. file write tablecontent _n 

. 
. tabulatevariable, variable(statin) min(0) max(1) missing
  2,463,707
  2,153,317
  1,927,284
  1,704,063
  109,656
  90,201
  2,463,707
  310,390
  1,927,284
  223,221
  109,656
  19,455
  2,463,707
  0
  1,927,284
  0
  109,656
  0

. file write tablecontent _n 

. 
. tabulatevariable, variable(ppi) min(0) max(1) missing
  2,463,707
  1,852,507
  1,927,284
  1,658,350
  109,656
  37,464
  2,463,707
  611,200
  1,927,284
  268,934
  109,656
  72,192
  2,463,707
  0
  1,927,284
  0
  109,656
  0

. file write tablecontent _n 

. 
. tabulatevariable, variable(steroid_prednisolone) min(0) max(1) missing
  2,463,707
  2,408,542
  1,927,284
  1,888,203
  109,656
  106,528
  2,463,707
  55,165
  1,927,284
  39,081
  109,656
  3,128
  2,463,707
  0
  1,927,284
  0
  109,656
  0

. file write tablecontent _n 

. 
. tabulatevariable, variable(hydroxychloroquine) min(0) max(1) missing
  2,463,707
  2,448,953
  1,927,284
  1,919,210
  109,656
  108,524
  2,463,707
  14,754
  1,927,284
  8,074
  109,656
  1,132
  2,463,707
  0
  1,927,284
  0
  109,656
  0

. file write tablecontent _n 

. 
. tabulatevariable, variable(dmards_primary_care) min(0) max(1) missing
  2,463,707
  2,426,080
  1,927,284
  1,906,514
  109,656
  106,917
  2,463,707
  37,627
  1,927,284
  20,770
  109,656
  2,739
  2,463,707
  0
  1,927,284
  0
  109,656
  0

. file write tablecontent _n 

. 
. tabulatevariable, variable(gp_consult) min(0) max(1) missing
  2,463,707
  231,601
  1,927,284
  216,450
  109,656
  3,015
  2,463,707
  2,232,106
  1,927,284
  1,710,834
  109,656
  106,641
  2,463,707
  0
  1,927,284
  0
  109,656
  0

. file write tablecontent _n 

. 
. tabulatevariable, variable(aande_attendance_last_year) min(0) max(1) missing
  2,463,707
  1,954,833
  1,927,284
  1,539,679
  109,656
  85,489
  2,463,707
  508,874
  1,927,284
  387,605
  109,656
  24,167
  2,463,707
  0
  1,927,284
  0
  109,656
  0

. file write tablecontent _n 

. 
. file write tablecontent _n _n

. 
. 
. * COMORBIDITIES (continuous)
. 
. summarizevariable, variable(gp_consult_count)

. summarizevariable, variable(age)

. summarizevariable, variable(aande_attendance_count)

. summarizevariable, variable(follow_up_ons)

. *summarizevariable, variable(follow_up_ecds)
. 
. file close tablecontent

. 
. * Close log file 
. log close
      name:  <unnamed>
       log:  E:\analyses\nsaids-covid-research\analysis\nsaid_log\Naproxen_04_an_descriptive_table.log
  log type:  text
 closed on:   7 Oct 2020, 14:11:19
------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
