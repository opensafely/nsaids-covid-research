----------------------------------------------------------------------------------------------------------------------------------------------------------------------------
      name:  <unnamed>
       log:  E:\alex\nsaids-covid-research\analysis\nsaid_log_sens3\09_an_model_exploration.log
  log type:  text
 opened on:  15 Jul 2020, 04:34:53

. 
. * Open Stata dataset
. use $tempdir\analysis_dataset_STSET_$outcome, clear

. 
. /* Print table================================================================*/ 
. *  Print the results for the main model 
. 
. cap file close tablecontent

. file open tablecontent using ./$outdir/table5.txt, write text replace

. 
. * Column headings 
. file write tablecontent ("Table 5: 1 by 1 comorbidity adjustments (after age/sex and strata adjustments) - $population population") _n

. file write tablecontent _tab ("HR") _tab ("95% CI") _n

. 
. /* Adjust one covariate at a time=============================================*/
. 
. foreach var in $varlist                    ///
>                            i.diabcat                   ///
>                            i.gp_consult                ///
>                            i.aande_attendance_last_year { 
  2.                                
.         local var: subinstr local var "i." ""
  3.         local lab: variable label `var'
  4.         file write tablecontent ("`lab'") _n 
  5.         
.         qui stcox i.exposure i.male age1 age2 age3 i.`var', strata(stp) 
  6.                 
.                 local lab0: label exposure 0
  7.                 local lab1: label exposure 1
  8. 
.                 file write tablecontent ("`lab0'") _tab
  9.                 file write tablecontent ("1.00 (ref)") _tab _n
 10.                 file write tablecontent ("`lab1'") _tab  
 11.                 
.                 qui lincom 1.exposure, eform
 12.                 file write tablecontent %4.2f (r(estimate)) _tab %4.2f (r(lb)) (" - ") %4.2f (r(ub)) _n _n
 13.                                                                         
. }               

. 
. file write tablecontent _n

. file close tablecontent

. 
. 
. 
end of do-file

. 
. 
. /*      SENSITIVITY ANALYSIS 4: =============================================
> Remove people who had indometacin 
>  ======================================================================*/
. clear

. 
. cd ..
E:\alex\nsaids-covid-research

. import delimited `c(pwd)'/output/input_nsaid_population.csv, clear
(69 vars, 2,459,715 obs)

. 
. set more off 

. 
. cd  "`c(pwd)'/analysis"
E:\alex\nsaids-covid-research\analysis

. 
. * Create directories required 
. 
. capture mkdir nsaid_output_sens4

. capture mkdir nsaid_log_sens4

. capture mkdir nsaid_tempdata_sens4

. 
. * Set globals that will print in programs and direct output
. 
. global population "nsaid"

. global outcome    "onscoviddeath"

. global outdir     "nsaid_output_sens4" 

. global logdir     "nsaid_log_sens4"

. global tempdir    "nsaid_tempdata_sens4"

. global varlist    i.obese4cat                       ///
>                                   i.smoke_nomiss                    ///
>                                   i.imd                                         ///
>                                   i.ckd                                         ///             
>                                   i.hypertension                        ///             
>                                   i.heart_failure                       ///             
>                                   i.other_heart_disease         ///             
>                                   i.diab_control                        ///     
>                                   i.copd                    ///
>                                   i.other_respiratory       ///
>                                   i.immunodef_any                       ///
>                                   i.cancer                              ///     
>                                   i.rheumatoid                          ///     
>                                   i.osteoarthritis                      ///     
>                                   i.statin                                      ///     
>                                   i.ppi                     ///
>                                   i.steroid_prednisolone    ///
>                                   i.hydroxychloroquine      ///
>                                   i.dmards_primary_care     ///
>                                   i.flu_vaccine                         ///     
>                                   i.pneumococcal_vaccine

. 
. /*  Pre-analysis data manipulation  */
. do "00_cr_create_analysis_dataset.do"

. /*==============================================================================
> DO FILE NAME:                   00_cr_create_analysis_dataset
> PROJECT:                                NSAID in COVID-19 
> DATE:                                   15 June 2020 
> AUTHOR:                                 A Wong (modified from ICS study by A Schultze)
>                                                                 
> DESCRIPTION OF FILE:    program 00, data management for NSAID project  
>                                                 reformat variables 
>                                                 categorise variables
>                                                 label variables 
> DATASETS USED:                  data in memory (from output/input_xxx.csv)
> 
> DATASETS CREATED:               none
> OTHER OUTPUT:                   logfiles, printed to folder analysis/$logdir
>                                                         
> ==============================================================================*/
. 
. * Open a log file
. 
. cap log close
